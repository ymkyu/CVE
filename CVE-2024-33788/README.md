# CVE-2024-33788

- [Linksys E5600](#linksys-e5600)
  * [Target](#target)
  * [Bug Type](#bug-type)
  * [Abstract](#abstract)
  * [Reproduce](#reproduce)
  * [Details](#details)
    + [Bug Causes](#bug-causes)
  * [Conclusion](#conclusion)
  * [Discoverer](#discoverer)

## Target

Linksys E5600 Router

| Firmware Version | Availability |
| --- | --- |
| 1.1.0.26 | True |

## Bug Type

Command Injection

## Abstract

Command Injection occurs when entering a value due to insufficient verification of the input value when registering a device PIN number that exists in the router's Configure -> Wi-Fi -> Wi-Fi Protect Config setting.

## Reproduce

```bash
python poc.py
```

## Details

### Bug Causes

`squashfs-root/usr/share/lua/runtime.lua:1561`

```bash
function runtime.wpsProcess(pt)
        local ret = '"OK"'

        print("wpsProcess")

    if pt["Mode"] == 'PBC' then
                os.execute("wps_action.sh PBC &")

        elseif pt["Mode"] == 'PIN' and pt["PinCode"] ~= nil then

[1]     cmd = 'wps_action.sh PIN '..pt["PinCode"]..' &'
[2]     os.execute(cmd)

    elseif pt["Mode"] == 'STOP' then
        print("wpsProcess STOP")

        cmd = 'ps | grep wps_action.sh | grep -v grep | awk \'{print $1}\' | xargs kill'
        os.execute(cmd)

        else
        print("wpsProcess Fail")
        end

       return ret
end
```

pt[”PinCode”] is not filtered.

it occurs command injection in `os.execute(cmd)`[1].

## Conclusion

Malicious Input can cause Command Injection in `runtime.wpsProcess` function.

It can be used as malicious way.

## Discoverer

CoreSecurity OT/ICS Research Team