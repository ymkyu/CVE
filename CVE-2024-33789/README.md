# CVE-2024-33789

- [Linksys E5600](#linksys-e5600)
  * [Target](#target)
  * [Bug Type](#bug-type)
  * [Abstract](#abstract)
  * [Reproduce](#reproduce)
  * [Details](#details)
    + [Bug Causes](#bug-causes)
  * [Conclusion](#conclusion)
  * [Discoverer](#discoverer)

## Target

Linksys E5600 Router

| Firmware Version | Availability |
| --- | --- |
| 1.1.0.26 | True |

## Bug Type

Command Injection

## Abstract

Command Injection is possible when the ping command is executed due to insufficient verification of the input value for the IP or URL address, which is the input value of the ping test present in the router's TroubleShooting -> Diagnostics menu.

## Reproduce

```bash
python poc.py
```

## Details

### Bug Causes

`squashfs-root/usr/share/lua/runtime.lua:491`

```bash
function runtime.pingTest(pt)
        local ret = '"NOK"'
        local logpath = "/tmp/ping.log"
        if pt ~= nil then
                print("Stop pingTest")
                os.execute("killall -2 ping")
                ret = '"OK"'
                if pt["count"] ~= nil and pt["pkgsize"] ~= nil and pt["ipurl"] ~=nil then
                        --For x86 -c option is not work
                        local copt=' '
                        if pt["count"] ~= '0' then
                                copt = " -c "..pt["count"]..copt
                        end
[1]                     local cmd = "/bin/ping -W1"..copt.."-s "..pt["pkgsize"].." "..pt["ipurl"].." > "..logpath.." 2>&1 &"
                        print("Do ["..cmd.."]")
[2]                     os.execute(cmd)
                        runtime.savefileline(logpath, "w", "1")
                        ret = '"OK"'
                end
                return ret
        else
                print("Only get ping result")
                ret = runtime.showfilefromline("pingTest", logpath, 1)
        end

        return ret
end
```

`pt[”ipurl”]` is not filtered.

it occurs command injection in `os.execute(cmd)`[1].

## Conclusion

Malicious Input can cause Command Injection in `runtime.pingTest` function.

It can be used as malicious way.

## Discoverer

CoreSecurity OT/ICS Research Team